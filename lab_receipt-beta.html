<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" name="viewport" 
        content="width=device-width, initial-scale=0.86, maximum-scale=5.0, minimum-scale=0.4"/>
    <meta name="theme-color" content="#FF7F50" />
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" type="image/png" href="img/ECSE211_org_192.png"/>
    <title>ECSE211 Lab Receipt Generator</title>

    <style>
      body { font-family: Arial, Verdana, 'sans-serif'; white-space: nowrap; }

      .rb:checked ~ label {
        color: white;
        background-color: coral;
      }

      .rb { display: none; }
      .rl { 
        padding: 20px;
        font-size: 16px;
      }

      .button {
        background-color: white;
        border-width: 1px;
        border-color: coral;
        color: coral;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        outline: none;
      }

      .tab {
        overflow: hidden;
        background-color: white;
        padding: 6px 12px;
      }

      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
      }

      .tab button:hover { background-color: #ddd; }
      .tab button.active {
        color: white;
        background-color: coral;
      }

      .tabcontent {
        display: none;
        padding: 6px 12px;
        animation: fadeEffect 0.2s;
      }

      @keyframes fadeEffect {
        from {opacity: 0;}
        to {opacity: 1;}
      }

      .group_num {
        border: none;
        outline: none;
        border-bottom: 2px solid grey;
      }

      .group_num:focus {
        border-bottom: 2px solid coral;
      }

      .clear_button {
        background-color: inherit;
        border: none;
        outline: none;
        padding: 7px 7px;
        transition: 0.3s;
        color: grey;
        font-size: 15px;
      }
    </style>

    <script>
      "use strict";

      var currentLab;

      /** Shorthand for document.getElementById(). */
      function g(id) {
        return document.getElementById(id);
      }

      /** Returns true if element is checked. */
      function c(input) {
        return g(input).checked;
      }

      function openLab(evt, labNum) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        currentLab = labNum;
        g("lab" + labNum).style.display = "block";
        evt.currentTarget.className += " active";
      }

      function generateReceipt() {
        var receiptElement = g("receipt" + currentLab);
        receiptElement.innerHTML = "";

        var questions = c("part_und" + currentLab)? 5 : c("full_und" + currentLab)? 10 : 0;
        var questionWeight = (currentLab == 5? 5 : 10);

        var part2Names = [null, "Bang-Bang Controller", "Float Motors", "Simple Navigation", "Ultrasonic Localization", "TBA"];
        var part2Notes = [null, (c("bb_done")? 10 : 0) + "/10",
          "XY: " + (c("fmxy_done")? 5 : 0) + "/5, Theta: " + (c("fmt_done")? 5 : 0) + "/5",
          "Minimal Angle: " + (c("minangle_done")? 5 : 0) + "/5, Distance Error: " + 
              (c("part_snavd")? 2.5 : (c("full_snavd")? 5 : 0)) + "/5",
          (c("part_us")? 2.5 : (c("full_us")? 5 : 0)) + "/5",
          "TBA"
        ];
        var part2Grades = [null, c("bb_done")? 10 : 0,
          (c("fmxy_done")? 5 : 0) + (c("fmt_done")? 5 : 0),
          (c("minangle_done")? 5 : 0) + (c("part_snavd")? 2.5 : (c("full_snavd")? 5 : 0)),
          c("part_us")? 2.5 : (c("full_us")? 5 : 0),
          null
        ];

        var part3Names = [null, "P-Type Controller" , "Odometer Check", "Obstacle Avoidance", "Light Localization", "TBA"];
        var part3Notes = [null, (c("p_done")? 10 : 0) + "/10",
          "Distance Error: " + (c("part_odod")? 2.5 : (c("full_odod")? 5 : 0)) + "/5, Theta error: " +
              (c("part_odot")? 2.5 : (c("full_odot")? 5 : 0)) + "/5",
          "Avoid all obstacles: " + (c("oa_done")? 5 : 0) + "/5, Distance error: " +
              (c("part_anavd")? 2.5 : (c("full_anavd")? 5 : 0)) + "/5",
          "Theta error: " + (c("part_llt")? 2.5 : (c("full_llt")? 5 : 0)) + "/5, Distance error: " +
              (c("lld2")? 2.5 : (c("lld5")? 5 : (c("lld7")? 7.5 : (c("lld10")? 10 : 0)))) + "/10",
          "TBA"
        ];
        var part3Grades = [null, c("p_done")? 10 : 0,
          (c("part_odod")? 2.5 : (c("full_odod")? 5 : 0)) + (c("part_odot")? 2.5 : (c("full_odot")? 5 : 0)),
          (c("oa_done")? 5 : 0) + (c("part_anavd")? 2.5 : (c("full_anavd")? 5 : 0)),
          (c("part_llt")? 2.5 : (c("full_llt")? 5 : 0)) + (c("lld2")? 2.5 : (c("lld5")? 5 : (c("lld7")? 7.5 : (c("lld10")? 10 : 0)))),
          null
        ];

        var receiptText = `
          <b>ECSE211 Lab ${currentLab} Receipt</b><br>
          ${addGroupNumberToReceiptTextIfSet()}
          Questions: ${questions}/${questionWeight}<br>
          ${part2Names[currentLab]}: ${part2Notes[currentLab]}<br>
          ${part3Names[currentLab]}: ${part3Notes[currentLab]}<br>
          <b>Total: ${questions + part2Grades[currentLab] + part3Grades[currentLab]}/30</b><br>
        `;

        // fallback used on old browsers
        var plainReceiptText =
          `ECSE211 Lab ${currentLab} Receipt\n` +
          `Questions: ${questions}/${questionWeight}\n` +
          `${part2Names[currentLab]}: ${part2Notes[currentLab]}\n` +
          `${part3Names[currentLab]}: ${part3Notes[currentLab]}\n` +
          `Total: ${questions + part2Grades[currentLab] + part3Grades[currentLab]}/30\n`;

        receiptElement.innerHTML += receiptText;
        setClipboard(receiptText, plainReceiptText);
      }

      /**
       * Sets the clipboard to text, or if that is not possible, to plaintext. 
       * asyncClipboard should be enabled in Firefox.
       * 
       * See browser documentation on copying html to clipboard.
       */
      function setClipboard(text, plaintext) {
        var fallback = () => legacySetClipboard(plaintext);
        if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
          fallback();
          return;
        }

        try {
          navigator.permissions.query({name: "clipboard-write"}).then(result => {
            try {
              let data = new DataTransfer();

              if (navigator.clipboard.write) {
                data.items.add("text/html", text);
                navigator.clipboard.write(data).then(() => {}, fallback);
              } else if (navigator.clipboard.writeText) {
                data.items.add("text/plain", plaintext);
                navigator.clipboard.writeText(data.types[0]).then(() => {}, fallback);
              } else {
                fallback();
              }
            } catch (error) {
              fallback();
            }
          });
        } catch (error) {
          fallback();
        }
      }

      /**
       *  Legacy method to copy plaintext to clipboard on old browsers.
       *
       *  Adapted from techoverflow.net/2018/03/30/copying-strings-to-the-clipboard-using-pure-javascript/
       */
       function legacySetClipboard(str) {
        var el = document.createElement('textarea');
        el.value = str;
        el.setAttribute('readonly', '');
        el.style = {position: 'absolute', left: '-9999px'};
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
      }

      /**
       * Returns the group number, or null if not set or invalid.
       */
      function getGroupNumber() {
        let n = g("group_num").value;
        if (n == "" || isNaN(n))
          return null;
        return parseInt(n);
      }
      
      /**
       * Clears the group number, to allow writing another one easily.
       */
      function clearGroupNumber() {
        g("group_num").value = "";
        g("group_num").focus();
      }

      /**
       * Adds the group number to receipt text if it is set.
       */
      function addGroupNumberToReceiptTextIfSet() {
        const n = getGroupNumber();
        if (n == null) return "";

        return `Group number: ${n}<br>`;
      }
    </script>
  </head>

  <body>
    <h1>&nbsp;&nbsp;ECSE211 Lab Receipt Generator</h1>

    &nbsp;&nbsp;&nbsp;&nbsp;Group Number:&nbsp;&nbsp;
    <!-- Use telephone format to enforce numeric keypad -->
    <input class="group_num" id="group_num" maxlength="2" type="tel">
    <button class="clear_button" id="clear_group_num_btn" onclick="clearGroupNumber()">&times;</button>

    <h2>&nbsp;&nbsp;Lab number</h2>

    <div class="tab">
      <button class="tablinks" onclick="openLab(event, 1)">LAB 1</button>
      <button class="tablinks" onclick="openLab(event, 2)">LAB 2</button>
      <button class="tablinks" onclick="openLab(event, 3)">LAB 3</button>
      <button class="tablinks" onclick="openLab(event, 4)">LAB 4</button>
      <button class="tablinks" onclick="openLab(event, 5)">LAB 5</button>
    </div>
    
    <div id="lab1" class="tabcontent">
      <h2>Questions (/10)</h2><br>
      <span><input id=no_und1 class=rb name=qst1 type=radio><label class=rl for=no_und1>NO</label></span>
      <span><input id=part_und1 class=rb name=qst1 type=radio><label class=rl for=part_und1>PARTIAL</label></span>
      <span><input id=full_und1 class=rb name=qst1 type=radio><label class=rl for=full_und1>FULL</label></span>
      <span>&nbsp;&nbsp;&nbsp;Understanding</span><br><br>

      <h2>Bang-Bang Controller (/10)</h2><br>
      <span><input id=bb_done class=rb name=bangbang type=radio><label class=rl for=bb_done>YES</label></span>
      <span><input id=bb_not_done class=rb name=bangbang type=radio><label class=rl for=bb_not_done>NO</label></span>
      <br><br>

      <h2>P-Type Controller (/10)</h2><br>
      <span><input id=p_done class=rb name=ptype type=radio><label class=rl for=p_done>YES</label></span>
      <span><input id=p_not_done class=rb name=ptype type=radio><label class=rl for=p_not_done>NO</label></span>
      <br><br><br>

      <button class="button" onclick="generateReceipt()"><b>GENERATE RECEIPT</b></button><br><br>
      <div id=receipt1></div>
    </div>

    <div id="lab2" class="tabcontent">
      <h2>Questions (/10)</h2><br>
      <span><input id=no_und2 class=rb name=qst2 type=radio><label class=rl for=no_und2>NO</label></span>
      <span><input id=part_und2 class=rb name=qst2 type=radio><label class=rl for=part_und2>PARTIAL</label></span>
      <span><input id=full_und2 class=rb name=qst2 type=radio><label class=rl for=full_und2>FULL</label></span>
      <span>&nbsp;&nbsp;&nbsp;Understanding</span><br><br>

      <h2>Float Motors (/10)</h2><br>
      <span><input id=fmxy_done class=rb name=floatmotors type=checkbox><label class=rl for=fmxy_done>XY (/5)</label></span>
      <span><input id=fmt_done class=rb name=floatmotors type=checkbox><label class=rl for=fmt_done>THETA (/5)</label></span>
      <br><br>

      <h2>Odometer Check (/10)</h2>
      <b>Distance error (cm):</b><br><br><br>
      <span><input id=full_odod class=rb name=odod type=radio><label class=rl for=full_odod>[0, 2]</label></span>
      <span><input id=part_odod class=rb name=odod type=radio><label class=rl for=part_odod>(2, 4]</label></span>
      <span><input id=no_odod class=rb name=odod type=radio><label class=rl for=no_odod>(4, &infin;)</label></span>
      <br><br><br>
      <b>Theta error (&deg;):</b><br><br><br>
      <span><input id=full_odot class=rb name=odot type=radio><label class=rl for=full_odot>[0, 10]</label></span>
      <span><input id=part_odot class=rb name=odot type=radio><label class=rl for=part_odot>(10, 20]</label></span>
      <span><input id=no_odot class=rb name=odot type=radio><label class=rl for=no_odot>(20, 180]</label></span>
      <br><br><br>

      <button class="button" onclick="generateReceipt()"><b>GENERATE RECEIPT</b></button><br><br>
      <div id=receipt2></div>
    </div>

    <div id="lab3" class="tabcontent">
      <h2>Questions (/10)</h2><br>
      <span><input id=no_und3 class=rb name=qst3 type=radio><label class=rl for=no_und3>NO</label></span>
      <span><input id=part_und3 class=rb name=qst3 type=radio><label class=rl for=part_und3>PARTIAL</label></span>
      <span><input id=full_und3 class=rb name=qst3 type=radio><label class=rl for=full_und3>FULL</label></span>
      <span>&nbsp;&nbsp;&nbsp;Understanding</span><br><br>

      <h2>Simple Navigation (/10)</h2>
      <b>Minimal angle:</b><br><br><br>
      <span><input id=minangle_done class=rb name=minangle type=radio><label class=rl for=minangle_done>YES</label></span>
      <span><input id=minangle_not_done class=rb name=minangle type=radio><label class=rl for=minangle_not_done>NO</label></span>
      <br><br><br>
      <b>Distance error (cm):</b><br><br><br>
      <span><input id=full_snavd class=rb name=snavd type=radio><label class=rl for=full_snavd>[0, 2]</label></span>
      <span><input id=part_snavd class=rb name=snavd type=radio><label class=rl for=part_snavd>(2, 4]</label></span>
      <span><input id=no_snavd class=rb name=snavd type=radio><label class=rl for=no_snavd>(4, &infin;)</label></span>
      <br><br>

      <h2>Navigation with Obstacle Avoidance (/10)</h2>
      <b>Avoid all obstacles:</b><br><br><br>
      <span><input id=oa_done class=rb name=oa type=radio><label class=rl for=oa_done>YES</label></span>
      <span><input id=oa_not_done class=rb name=oa type=radio><label class=rl for=oa_not_done>NO</label></span>
      <br><br><br>
      <b>Distance error (cm):</b><br><br><br>
      <span><input id=full_anavd class=rb name=anavd type=radio><label class=rl for=full_anavd>[0, 2]</label></span>
      <span><input id=part_anavd class=rb name=anavd type=radio><label class=rl for=part_anavd>(2, 4]</label></span>
      <span><input id=no_anavd class=rb name=anavd type=radio><label class=rl for=no_anavd>(4, &infin;)</label></span>
      <br><br><br>

      <button class="button" onclick="generateReceipt()"><b>GENERATE RECEIPT</b></button><br><br>
      <div id=receipt3></div>
    </div>

    <div id="lab4" class="tabcontent">
      <h2>Questions (/10)</h2><br>
      <span><input id=no_und4 class=rb name=qst4 type=radio><label class=rl for=no_und4>NO</label></span>
      <span><input id=part_und4 class=rb name=qst4 type=radio><label class=rl for=part_und4>PARTIAL</label></span>
      <span><input id=full_und4 class=rb name=qst4 type=radio><label class=rl for=full_und4>FULL</label></span>
      <span>&nbsp;&nbsp;&nbsp;Understanding</span><br><br>

      <h2>Ultrasonic Localization (/5)</h2>
      <b>Theta error (&deg;):</b><br><br><br>
      <span><input id=full_us class=rb name=usloc type=radio><label class=rl for=full_us>[0, 10]</label></span>
      <span><input id=part_us class=rb name=usloc type=radio><label class=rl for=part_us>(10, 20]</label></span>
      <span><input id=no_us class=rb name=usloc type=radio><label class=rl for=no_us>(20, 180]</label></span>
      <br><br>

      <h2>Light Localization (/15)</h2>
      <b>Theta error (&deg;):</b> (/5)<br><br><br>
      <span><input id=full_llt class=rb name=llt type=radio><label class=rl for=full_llt>[0, 10]</label></span>
      <span><input id=part_llt class=rb name=llt type=radio><label class=rl for=part_llt>(10, 20]</label></span>
      <span><input id=no_llt class=rb name=llt type=radio><label class=rl for=no_llt>(20, 180]</label></span>
      <br><br><br>
      <b>Distance error (cm):</b> (/10)<br><br><br>
      <span><input id=lld10 class=rb name=lld type=radio><label class=rl for=lld10>[0, 2]</label></span>
      <span><input id=lld7 class=rb name=lld type=radio><label class=rl for=lld7>(2, 4]</label></span>
      <span><input id=lld5 class=rb name=lld type=radio><label class=rl for=lld5>(4, 6]</label></span>
      <span><input id=lld2 class=rb name=lld type=radio><label class=rl for=lld2>(6, 8]</label></span>
      <span><input id=lld0 class=rb name=lld type=radio><label class=rl for=lld0>(8, &infin;)</label></span>
      <br><br><br>

      <button class="button" onclick="generateReceipt()"><b>GENERATE RECEIPT</b></button><br><br>
      <div id=receipt4></div>
    </div>

    <div id="lab5" class="tabcontent">
      <h2>Project-specific lab scheme TBA</h2>
    </div>
  </body>

</html> 
